<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Scan & Go Local+</title>
<style>
  :root{--bg:#ffffff;--fg:#111;--brand:#0f6;--muted:#666}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--fg)}
  .wrap{max-width:800px;margin:0 auto;padding:20px}
  .hero{display:flex;gap:16px;align-items:center}
  .pic{width:88px;height:88px;border-radius:16px;object-fit:cover;border:1px solid #eee}
  h1{margin:0 0 6px;font-size:28px}
  .tag{color:var(--muted);margin:0 0 6px}
  .btns{display:flex;flex-wrap:wrap;gap:10px;margin:12px 0}
  a.btn{display:inline-block;padding:10px 14px;border:1px solid #111;border-radius:10px;text-decoration:none;color:#111}
  a.btn.primary{background:#111;color:#fff}
  .card{border:1px solid #eee;border-radius:12px;padding:14px;margin:12px 0}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
  .muted{color:#666}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #ddd;margin:2px 6px 0 0}
  footer{padding:20px;color:#666;text-align:center;font-size:12px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <img id="pic" class="pic" alt="photo">
      <div>
        <h1 id="name">Nom</h1>
        <div id="headline" class="tag">Slogan / activité</div>
        <div id="addr" class="muted"></div>
      </div>
    </div>

    <div id="desc" class="card" style="display:none"></div>

    <div class="btns" id="contacts"></div>

    <div class="card">
      <h3>Soutenir / laisser un don</h3>
      <div class="btns" id="donations"></div>
      <div class="btns">
        <input id="freeAmount" type="number" step="0.1" min="0" placeholder="Autre montant" style="padding:10px;border:1px solid #ccc;border-radius:8px">
        <a id="payFree" class="btn primary" target="_blank" rel="noopener">Payer</a>
      </div>
      <div class="muted" style="margin-top:6px">Paiement traité par votre prestataire (Stripe/PayPal/Lydia). Nous ne stockons aucune donnée bancaire.</div>
    </div>

    <div id="hours" class="card" style="display:none">
      <h3>Horaires</h3>
      <div id="hoursTxt"></div>
    </div>

    <div id="links" class="card" style="display:none">
      <h3>Liens</h3>
      <div id="linksList" class="grid"></div>
    </div>

    <footer>© Scan & Go Local+ — Page générée automatiquement</footer>
  </div>

<script>
function qs(n){ return new URLSearchParams(location.search).get(n) || '' }

const name = qs('name') || 'Boulangerie de Quartier';
const headline = qs('headline') || 'Pain, café & bons sourires';
const photo = qs('photo') || '';
const addr = qs('address') || '';
const desc = qs('desc') || '';
const hours = qs('hours') || '';
const theme = qs('theme') || 'light';
const accents = qs('accent') || '#0f6';

// Contacts
const phone = qs('phone');
const whatsapp = qs('wa');
const email = qs('email');
const site = qs('site');
const maps = qs('maps');

// Donations
const pay = qs('pay');            // lien générique (montant libre)
const pay2 = qs('pay2');          // alternativement liens fixes
const pay5 = qs('pay5');
const pay10 = qs('pay10');
const amounts = (qs('amounts') || '2,5,10').split(',').map(x=>x.trim()).filter(Boolean);

document.documentElement.style.setProperty('--brand', accents);

// Fill hero
document.getElementById('name').textContent = name;
document.getElementById('headline').textContent = headline;
document.getElementById('addr').textContent = addr;
const pic = document.getElementById('pic');
if(photo){ pic.src = photo } else { pic.style.display = 'none' }

// Desc
if(desc){
  const el = document.getElementById('desc');
  el.style.display = 'block';
  el.textContent = desc;
}

// Contacts
const contacts = document.getElementById('contacts');
function addBtn(txt, href, primary=false){
  if(!href) return;
  const a = document.createElement('a');
  a.className = 'btn' + (primary ? ' primary' : '');
  a.textContent = txt;
  a.href = href; a.target = '_blank'; a.rel = 'noopener';
  contacts.appendChild(a);
}
if(phone) addBtn('Appeler', 'tel:'+phone, true);
if(whatsapp) addBtn('WhatsApp', 'https://wa.me/'+whatsapp.replace(/^\+/,''));
if(email) addBtn('Email', 'mailto:'+email);
if(maps) addBtn('Itinéraire', maps);

// Links
const links = [];
if(site) links.push(['Site', site]);
['ig','fb','tt','yt','tw','ln','tg'].forEach(k=>{
  const v = qs(k); if(v) links.push([k.toUpperCase(), v]);
});
if(links.length){
  document.getElementById('links').style.display='block';
  const box = document.getElementById('linksList');
  links.forEach(([label, href])=>{
    const a = document.createElement('a');
    a.className='btn'; a.textContent=label; a.href=href; a.target='_blank'; a.rel='noopener';
    box.appendChild(a);
  });
}

// Hours
if(hours){
  const el = document.getElementById('hours');
  el.style.display='block';
  document.getElementById('hoursTxt').textContent = hours;
}

// Donations quick buttons
const dons = document.getElementById('donations');
function money(x){ try{ return new Intl.NumberFormat(undefined,{style:'currency',currency:'EUR'}).format(parseFloat(x)) } catch(e){ return x+'€' } }
function makeQuick(amount){
  const a = document.createElement('a'); a.className='btn';
  a.textContent = money(amount);
  let url = pay;
  const alt = (amount=='2'&&pay2)||(amount=='5'&&pay5)||(amount=='10'&&pay10);
  if(alt){ url = alt }
  else if(pay){
    const u = new URL(pay, location.href);
    if(!u.searchParams.has('amount')) u.searchParams.append('amount', amount);
    url = u.toString();
  }
  a.href = url || '#'; a.target='_blank'; a.rel='noopener';
  dons.appendChild(a);
}
amounts.forEach(a=>makeQuick(a));

const freeAmt = document.getElementById('freeAmount');
const payFree = document.getElementById('payFree');
function updateFree(){
  let url = pay || '#';
  const v = freeAmt.value;
  if(v && !isNaN(parseFloat(v))){
    const u = new URL(pay || '#', location.href);
    if(!u.searchParams.has('amount')) u.searchParams.append('amount', v);
    url = u.toString();
  }
  payFree.href = url;
}
freeAmt.addEventListener('input', updateFree);
updateFree();
</script>
</body>
</html>