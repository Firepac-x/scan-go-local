<!doctype html>
<html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Page publique â€” QRLocal</title><link rel="manifest" href="manifest.json"><meta name="theme-color" content="#ffffff">
<style>:root{--green:#0f6;--fg:#111;--muted:#666}body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;color:var(--fg);background:#fff}
.wrap{max-width:820px;margin:0 auto;padding:16px}.hero{display:flex;gap:16px;align-items:center}.pic{width:88px;height:88px;border-radius:16px;object-fit:cover;border:1px solid #eee}
h1{margin:0 0 6px;font-size:28px}.tag{color:#666;margin:0 0 6px}.btns{display:flex;flex-wrap:wrap;gap:10px;margin:12px 0}
a.btn{display:inline-block;padding:10px 14px;border-radius:12px;text-decoration:none;border:1px solid #111;color:#111;font-weight:700}
a.btn.primary{background:#111;color:#fff;border-color:#111}.card{background:#fff;border:1px solid #eee;border-radius:14px;padding:14px;margin:12px 0;box-shadow:0 6px 20px rgba(0,0,0,.03)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}.notice{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#111;color:#fff;padding:10px 14px;border-radius:12px;opacity:0;transition:opacity .4s}
.notice.show{opacity:1}textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:10px}.info{font-size:12px;color:#666}</style></head>
<body><div class="wrap"><div class="info">Espace public â€” donnÃ©es servies par le backend.</div>
<div class="hero"><img id="pic" class="pic" alt="photo"><div><h1 id="name">Nom</h1><div id="headline" class="tag"></div><div id="addr" class="tag"></div></div></div>
<div id="thanks" class="card" style="display:none"></div><div id="desc" class="card" style="display:none"></div><div class="btns" id="contacts"></div>
<div class="card"><h3>Soutenir / don</h3><div class="btns" id="donations"></div><div class="btns"><input id="freeAmount" type="number" step="0.1" min="0" placeholder="Autre montant" style="padding:10px;border:1px solid #ccc;border-radius:10px"><a id="payFree" class="btn primary" target="_blank" rel="noopener">Payer</a></div>
<div style="color:#666;margin-top:6px">Paiement via Stripe/PayPal/Lydia.</div></div>
<div id="links" class="card" style="display:none"><h3>Liens</h3><div id="linksList" class="grid"></div></div>
<div id="msg" class="card"><h3>Laisser un message</h3><textarea id="messageBox" rows="3" placeholder="Un petit mot..."></textarea><div class="btns"><a id="sendMsg" class="btn">Envoyer par eâ€‘mail</a></div></div></div>
<div id="notice" class="notice">ðŸ¥³ Merci pour votre don !</div>
<script>
const WORKER_ORIGIN='https://your-worker-subdomain.workers.dev';const WHITELIST=['buy.stripe.com','www.paypal.com','paypal.com','lydia-app.com'];
function qs(n){return new URLSearchParams(location.search).get(n)||''}function money(x){try{return new Intl.NumberFormat(undefined,{style:'currency',currency:'EUR'}).format(parseFloat(x))}catch(e){return x+'â‚¬'}}
async function load(){const slug=qs('slug');if(!slug){document.body.innerHTML='<div class="wrap">Slug manquant.</div>';return;}const res=await fetch(WORKER_ORIGIN+'/api/page/get?slug='+encodeURIComponent(slug));const j=await res.json().catch(()=>({ok:false}));
if(!j.ok){document.body.innerHTML='<div class="wrap">Page introuvable.</div>';return;}const d=j.data||{};document.getElementById('name').textContent=d.name||'BÃ©nÃ©ficiaire';document.getElementById('headline').textContent=d.headline||'';document.getElementById('addr').textContent=d.address||'';
const pic=document.getElementById('pic');if(d.photo){pic.src=d.photo}else{pic.style.display='none'}if(d.desc){const el=document.getElementById('desc');el.style.display='block';el.textContent=d.desc;}if(d.thanks){const el=document.getElementById('thanks');el.style.display='block';el.textContent=d.thanks;}
const contacts=document.getElementById('contacts');function addBtn(txt,href,primary=false){if(!href)return;const a=document.createElement('a');a.className='btn'+(primary?' primary':'');a.textContent=txt;a.href=href;a.target='_blank';a.rel='noopener';contacts.appendChild(a);}if(d.phone)addBtn('Appeler','tel:'+d.phone,true);
if(d.wa)addBtn('WhatsApp','https://wa.me/'+d.wa.replace(/^\+/,''));if(d.email)addBtn('Email','mailto:'+d.email);if(d.maps)addBtn('ItinÃ©raire',d.maps);if(d.site)addBtn('Site',d.site);
const social=[];[['IG','ig'],['FB','fb'],['YT','yt']].forEach(([l,k])=>{const v=d[k];if(v)social.push([l,v]);});if(social.length){document.getElementById('links').style.display='block';const box=document.getElementById('linksList');social.forEach(([label,href])=>{const a=document.createElement('a');a.className='btn';a.textContent=label;a.href=href;a.target='_blank';a.rel='noopener';box.appendChild(a);});}
const pay=d.pay||'';const amounts=(d.amounts||'2,5,10').split(',').map(x=>x.trim()).filter(Boolean);const dons=document.getElementById('donations');
function allowed(u){try{return WHITELIST.includes(new URL(u, location.href).host.toLowerCase())}catch(e){return false}}function quick(amount){const a=document.createElement('a');a.className='btn';a.textContent=money(amount);
let url='#';if(pay&&allowed(pay)){const u=new URL(pay,location.href);if(!u.searchParams.has('amount'))u.searchParams.append('amount',amount);if(!u.searchParams.has('return_url'))u.searchParams.append('return_url',location.origin+location.pathname+'?paid=true&slug='+encodeURIComponent(slug));url=u.toString();}
a.href=url;a.target='_blank';a.rel='noopener';dons.appendChild(a);}amounts.forEach(a=>quick(a));const freeAmt=document.getElementById('freeAmount');const payFree=document.getElementById('payFree');
function updateFree(){let url='#';const v=freeAmt.value;if(v&&!isNaN(parseFloat(v))&&pay&&allowed(pay)){const u=new URL(pay,location.href);if(!u.searchParams.has('amount'))u.searchParams.append('amount',v);if(!u.searchParams.has('return_url'))u.searchParams.append('return_url',location.origin+location.pathname+'?paid=true&slug='+encodeURIComponent(slug));url=u.toString();}payFree.href=url;}
freeAmt.addEventListener('input',updateFree);updateFree();if(qs('paid')==='true'){const n=document.getElementById('notice');n.classList.add('show');setTimeout(()=>n.classList.remove('show'),3500);}document.getElementById('sendMsg').addEventListener('click',(e)=>{
e.preventDefault();const msg=(document.getElementById('messageBox').value||'');const to=(d.contact||'');if(!to){alert('Aucune adresse de contact dÃ©finie.');return;}const subject='Message via QRLocal â€” '+(d.name||'');const body=msg||'Bonjour !';window.location.href='mailto:'+to+'?subject='+encodeURIComponent(subject)+'&body='+encodeURIComponent(body);});}
load();
</script></body></html>