<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Profil ‚Äî QRLocal</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffffff">
<style>
  :root{--green:#0f6;--fg:#111;--muted:#666}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;color:var(--fg)}
  .topbar{position:sticky;top:0;background:#fff;border-bottom:1px solid #eee;padding:10px 16px;z-index:100}
  a.back{text-decoration:none;color:var(--green);font-weight:700}
  .wrap{max-width:820px;margin:0 auto;padding:16px}
  .hero{display:flex;gap:16px;align-items:center}
  .pic{width:88px;height:88px;border-radius:16px;object-fit:cover;border:1px solid #eee}
  h1{margin:0 0 6px;font-size:28px}
  .tag{color:var(--muted);margin:0 0 6px}
  .btns{display:flex;flex-wrap:wrap;gap:10px;margin:12px 0}
  a.btn{display:inline-block;padding:10px 14px;border-radius:12px;text-decoration:none;border:1px solid #111;color:#111;font-weight:700}
  a.btn.primary{background:var(--fg);color:#fff;border-color:var(--fg)}
  .card{background:#fff;border:1px solid #eee;border-radius:14px;padding:14px;margin:12px 0;box-shadow:0 6px 20px rgba(0,0,0,.03)}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
  .notice{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#111;color:#fff;padding:10px 14px;border-radius:12px;opacity:0;transition:opacity .4s}
  .notice.show{opacity:1}
</style>
</head>
<body>
<div class="topbar"><a class="back" href="index.html">‚Üê Accueil</a></div>
<div class="wrap">
  <div class="hero">
    <img id="pic" class="pic" alt="photo">
    <div>
      <h1 id="name">Nom</h1>
      <div id="headline" class="tag">Slogan / activit√©</div>
      <div id="addr" class="tag"></div>
    </div>
  </div>

  <div id="desc" class="card" style="display:none"></div>
  <div class="btns" id="contacts"></div>

  <div class="card">
    <h3>Soutenir / don</h3>
    <div class="btns" id="donations"></div>
    <div class="btns">
      <input id="freeAmount" type="number" step="0.1" min="0" placeholder="Autre montant" style="padding:10px;border:1px solid #ccc;border-radius:10px">
      <a id="payFree" class="btn primary" target="_blank" rel="noopener">Payer</a>
    </div>
    <div style="color:#666;margin-top:6px">Paiement via Stripe/PayPal/Lydia. Aucune donn√©e bancaire n'est stock√©e ici.</div>
  </div>

  <div id="links" class="card" style="display:none">
    <h3>Liens</h3>
    <div id="linksList" class="grid"></div>
  </div>
</div>

<div id="notice" class="notice">ü•≥ Merci pour votre don ! Votre soutien fait vivre le local üíö</div>

<script>
function qs(n){ return new URLSearchParams(location.search).get(n) || '' }
function money(x){ try{ return new Intl.NumberFormat(undefined,{style:'currency',currency:'EUR'}).format(parseFloat(x)) } catch(e){ return x+'‚Ç¨' } }

const name = qs('name') || 'Boulangerie de Quartier';
const headline = qs('headline') || 'Pain, caf√© & bons sourires';
const photo = qs('photo') || '';
const addr = qs('address') || '';
const desc = qs('desc') || '';
const pay = qs('pay') || 'https://buy.stripe.com/test_6oE03kA9d3Yf4bGcMN';
const pay2 = qs('pay2'); const pay5 = qs('pay5'); const pay10 = qs('pay10');
const amounts = (qs('amounts') || '2,5,10').split(',').map(x=>x.trim()).filter(Boolean);

document.getElementById('name').textContent = name;
document.getElementById('headline').textContent = headline;
document.getElementById('addr').textContent = addr;
const pic = document.getElementById('pic'); if(photo){ pic.src = photo } else { pic.style.display='none' }

if(desc){ const el = document.getElementById('desc'); el.style.display='block'; el.textContent = desc; }

const contacts = document.getElementById('contacts');
function addBtn(txt, href, primary=false){
  if(!href) return;
  const a = document.createElement('a'); a.className='btn' + (primary?' primary':'');
  a.textContent = txt; a.href = href; a.target='_blank'; a.rel='noopener';
  contacts.appendChild(a);
}
const phone = qs('phone'); const wa = qs('wa'); const email = qs('email'); const maps = qs('maps'); const site = qs('site');
if(phone) addBtn('Appeler','tel:'+phone,true);
if(wa) addBtn('WhatsApp','https://wa.me/'+wa.replace(/^\+/,''));
if(email) addBtn('Email','mailto:'+email);
if(maps) addBtn('Itin√©raire', maps);
if(site) addBtn('Site', site);

const links = [];
['ig','fb','yt','tt','tw','ln','tg'].forEach(k=>{ const v = qs(k); if(v) links.push([k.toUpperCase(), v]); });
if(links.length){
  document.getElementById('links').style.display='block';
  const box = document.getElementById('linksList');
  links.forEach(([label, href])=>{
    const a = document.createElement('a'); a.className='btn'; a.textContent=label; a.href=href; a.target='_blank'; a.rel='noopener'; box.appendChild(a);
  });
}

const dons = document.getElementById('donations');
function quick(amount){
  const a = document.createElement('a'); a.className='btn'; a.textContent = money(amount);
  let url = pay;
  const alt = (amount=='2'&&pay2)||(amount=='5'&&pay5)||(amount=='10'&&pay10);
  if(alt){ url = alt }
  else if(pay){
    const u = new URL(pay, location.href);
    if(!u.searchParams.has('amount')) u.searchParams.append('amount', amount);
    if(!u.searchParams.has('return_url')) u.searchParams.append('return_url', location.origin + location.pathname + '?paid=true');
    url = u.toString();
  }
  a.href = url || '#'; a.target='_blank'; a.rel='noopener';
  dons.appendChild(a);
}
amounts.forEach(a=>quick(a));

const freeAmt = document.getElementById('freeAmount'); const payFree = document.getElementById('payFree');
function updateFree(){
  let url = pay || '#'; const v = freeAmt.value;
  if(v && !isNaN(parseFloat(v)) && pay){
    const u = new URL(pay, location.href);
    if(!u.searchParams.has('amount')) u.searchParams.append('amount', v);
    if(!u.searchParams.has('return_url')) u.searchParams.append('return_url', location.origin + location.pathname + '?paid=true');
    url = u.toString();
  }
  payFree.href = url;
}
freeAmt.addEventListener('input', updateFree); updateFree();

if(qs('paid') === 'true'){
  const n = document.getElementById('notice'); n.classList.add('show');
  setTimeout(()=>n.classList.remove('show'), 3500);
}
</script>
</body>
</html>